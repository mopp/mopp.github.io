<!DOCTYPE html><html><head><meta charset="utf8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>moppris</title><!-- Pure.css--><link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="/css/side-menu.css"><!-- Fonts--><link rel="stylesheet" href="http://fonts.googleapis.com/earlyaccess/notosansjp.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Josefin+Sans:400,700|Arimo:400,700"><!-- Icons--><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.rawgit.com/konpa/devicon/master/devicon.min.css"><link rel="stylesheet" href="/css/main.css"></head><body><div id="layout"><a href="#menu" id="menuLink" class="menu-link"><span></span></a><div id="menu"><div class="pure-menu"><a href="/" class="pure-menu-heading">moppris</a><ul class="pure-menu-list"><li class="pure-menu-item"><img id="menu-mopp-icon" src="/img/mopp_main_icon.png" class="circle_img"></li><li class="pure-menu-item"><a href="/" class="pure-menu-link"><i class="menu-icon fa fa-desktop"></i><span>Home</span></a></li><li class="pure-menu-item"><a href="/profile" class="pure-menu-link"><i class="menu-icon fa fa-user"></i><span>Profile</span></a></li><li class="pure-menu-item"><a href="/products" class="pure-menu-link"><i class="menu-icon fa fa-file"></i><span>Products</span></a></li><li class="pure-menu-item"><a href="/articles/top" class="pure-menu-link"><i class="menu-icon fa fa-book"></i><span>Articles</span></a></li><li class="pure-menu-item"><a href="/contact" class="pure-menu-link"><i class="menu-icon fa fa-send-o"></i><span>Contact</span></a></li></ul></div><div id="menu-link-container"><a target="_blank" href="https://github.com/mopp"><i class="menu-link-icon fa fa-github"></i></a><a target="_blank" href="https://twitter.com/mopp_jp"><i class="menu-link-icon fa fa-twitter"></i></a><a target="_blank" href="https://www.amazon.co.jp/gp/registry/wishlist/L86ZMQY2FVE1"><i class="menu-link-icon fa fa-amazon"></i></a></div></div><div id="main"><div class="header"><h1>もぷりす</h1><h2>Mopp's Pages</h2></div><div class="content"><p>Created: 2016-06-08<br>Updated: 2016-06-09</p>
<h1>00. OSを自作したい</h1><hr>
<h2>はじめに</h2><p>コンピュータをカタカタしている人ならば一度は思ったことがあるはずですよね。
現在、Rust言語を使って、以前よりC言語で書いていたOSを書き直しています。
別ページに書いてある<a href="/products">Axel</a>というものです。<br>それにあたって、自作する知見をよくあるページみたいにまとめていけたらなあと思ったので、これを書いてみることにしました。
既にまとめられた優良なページはたくさんあります。つまり完全に自己満足です。<br>ゆっくりと書いていきたいと思います。</p>
<hr>
<h2>謝辞 / Acknowledgment</h2><p>今までOSを開発してきて、様々な書籍やWebサイトにお世話になりました。<br>それらをまとめてくれた全員に感謝すると共に、特に際立っているものを感謝の意を込めて、そして、ここを見てくれた人の参考にもなるようにいくつか掲載します.<br>あと、謝辞なので、日本人著者以外には英語で書いてみようと思います. 下手でも書かないと上達しないですからね.</p>
<ul>
<li><p>書籍</p>
<ul>
<li>川合 秀実, <a href="https://www.amazon.co.jp/30-OS/dp/4839919844/">30日でできる! OS自作入門</a><ul>
<li>名前の通り入門書に最適です。自分もここから入門しました。</li>
<li>OSはアーキテクチャの都合もありますが、実装をする際に面倒な部分は多くあります。 それらが初心者向けにきれいにまとめられており、大変な良著です。</li>
<li>このような本を世の中に出してくれた川合さんには感謝してもしきれません。</li>
</ul>
</li>
<li>Andrew S.Tanenbaum, <a href="https://www.amazon.co.jp/%E3%83%A2%E3%83%80%E3%83%B3-%E3%82%AA%E3%83%9A%E3%83%AC%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0-%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0-%E5%8E%9F%E6%9B%B8-%E7%AC%AC2%E7%89%88/dp/4894715376/">モダン オペレーティング システム 原書 第2版</a><ul>
<li>I would particularly like to thank Prof. Tanenbaum.</li>
<li>He is a father of Minix. This book is well-structured and the focus is theory of Operating System.</li>
<li>If you read, you can realize the reason why this book has been used for many lectures in academic.</li>
<li>The feature is that it contains overviews of Windows 2000 kernel and Unix kernel, and these are extremely curious.</li>
</ul>
</li>
<li>青柳 隆宏, <a href="https://www.amazon.co.jp/%E3%81%AF%E3%81%98%E3%82%81%E3%81%A6%E3%81%AEOS%E3%82%B3%E3%83%BC%E3%83%89%E3%83%AA%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-~UNIX-V6%E3%81%A7%E5%AD%A6%E3%81%B6%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%81%AE%E3%81%97%E3%81%8F%E3%81%BF-Software-Design/dp/4774154644/">はじめてのOSコードリーディング UNIX V6で学ぶカーネルのしくみ</a><ul>
<li>UNIX V6の古のコードを読むための本です。現在のUNIX系OSの根源が全て詰まっているソースコードをこれまたわかりやすく解説しています。</li>
<li>OSの理論や概念はわかってきたけど、実装に結びつかない、という人にピッタリだと思います。</li>
<li>それらをお手軽なサイズにまとめてくれたことに感謝です。</li>
</ul>
</li>
</ul>
</li>
<li><p>Webサイト</p>
<ul>
<li><a href="http://wiki.osdev.org/Main_Page">OSDev.org</a><ul>
<li>This wiki is biggest wiki on Internet I think. Many know-how are summarized into the wiki.</li>
<li>A forum of the wiki is also useful for beginners. These information helped me many times.</li>
<li>I would like to thank all participants of the wiki.</li>
</ul>
</li>
<li><a href="https://twitter.com/Nina_Petipa">@Nina_Petipa</a>, <a href="http://softwaretechnique.jp/OS_Development/index.html">０から作るOS開発</a><ul>
<li>x86_32でのOS自作に関して、ここより丁寧で良くまとまっているサイトはこの世界には無いだろうという丁寧にまとめられています。</li>
<li>はっきり言ってしまえば、OS自作の最初の段階では、ここにまとまっているもので全部足ります。</li>
<li>ページングの実装時には特にお世話になりました。ありがとうございます。</li>
</ul>
</li>
<li>Philipp Oppermann, <a href="http://os.phil-opp.com/">Writing an OS in Rust</a><ul>
<li>He has been showed me the way to develop an OS in Rust.</li>
<li>Currently my pages are backwords of this web site. His explanations about Rust and OS are really clear.</li>
<li>We can refer his source code in <a href="https://github.com/phil-opp/blog_os">his repository</a>.</li>
<li>I would like to offer my special thanks to him.</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2>そもそもOSってなんだろう</h2><p>OSとは何かということをじっくり説明すると、それだけで一つの授業(大学の学部でのOS論ですね)になってしまいます。<br>ここでは、ざっくりと以下の2つに絞って書いてみようと思います。</p>
<ul>
<li>OSの目的</li>
<li>OSの定義</li>
</ul>
<p>詳細はどこかの大学の授業で使用されているらしいWikiがあったので、そちらにおまかせしましょう。<br><a href="http://uc2.h2np.net/index.php">UNIXオペレーティングシステム</a><br>とてもわかり易く書いてあっていい授業のように見えます。<br><a href="https://ja.wikipedia.org/wiki/%E3%82%AA%E3%83%9A%E3%83%AC%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0">オペレーティングシステム</a><br>日本語版Wikipediaも、歴史などがよく書いてあって面白いです。</p>
<p>OSと言われて思い浮かぶのは何でしょうか？<br>こんなものを読んでいる人はやっぱりLinuxと言う人が多いかも知れないですね。
大抵は、Linux, Mac, Windowsの3つが大御所です。<br>しかしながら、これ以降は<strong>Unix系OSを前提に書いていきます。</strong>
これは、Unix系OS(LinuxやらFreeBSDなど)の多くがオープンソースであり、様々な解説やコードが既に存在するからです。</p>
<hr>
<h3>OSの目的</h3><p>一言で言ってしまえば、OSの目的とは<strong>ユーザの支援</strong>です。<br>上記のリンクでも同様のことが述べられていますが、具体的には、以下の3つが3本柱です。</p>
<ul>
<li>ハードウェア抽象化</li>
<li>リソース管理</li>
<li>スループット向上</li>
</ul>
<p>どれにせよ、全てはユーザのための機能です。<br>それぞれ例を交えて、説明してみます。</p>
<p>一つ目は、ハードウェア抽象化です。<br>例えば、LinuxやWindowsは、大抵のPCにインストール可能です。
そしてそれらはIntel CPUが入ってるものが殆どです。
ですが、全てのコンピュータがインテル入ってるではありません。
近年有名な、Raspberry Piは良い例です。
Raspberry PiはARM CPUを搭載しています。
ですが、Linuxが動作し、Intel CPUと変わらないように使用できます。
詳しくは知りませんが、WindowsもARM上で動くものが開発されているようです。<br>別々のCPUなのにOSはちゃんと動いて、使う分には何も差がない、これがハードウェアの抽象化です。</p>
<p>次はリソース管理です。<br>ここでの、リソースとはコンピュータ資源のことで、メインメモリやらHDDやら全てを指します。
たまに、メモリが足りなくてプログラムの動作が重いなんて言葉を聞きますが、そのメモリをプログラムに<strong>効率的</strong>に割り当てるのがOSの仕事です。
他にも複数のプログラムが一つのHDDのデータを参照するなんてことしょっちゅうあるはずですが、データの取り合いなんて起きません。
これも、OSがうまいこと管理しているからです。</p>
<p>最後にスループット向上です。<br>よく言われる説明ですが、PCを使って、音楽を聞きながら、ブラウジングして、メモを取るなんて誰しもが行っていることです。<br>ここで、それぞれのプログラムは別々の人が作った独立したプログラムです。しかし、うまいこと全部同時に動いています。<br>これによって、ユーザは様々な仕事を同時にこなすことができるようになります。
これをうまいこと動くようにしてやるのもOSの仕事です。
リソース管理と少し似たような説明になってしまいました。</p>
<hr>
<h3>OSの定義</h3><p>OSの定義は非常に曖昧です。<br>なので、大別して、<strong>狭義のOS</strong>と<strong>広義のOS</strong>があると言われています。<br>といっても、どこまでが狭義で、どこまでが広義かも特に決まりがあるわけでもないようです。
なので、自分の認識では、Linuxは狭義のOSでWindowsとMacは広義のOSだと思っています。<br>狭義のOSでは、OSのコア部分、いわゆるカーネルのみを指します。<br>対して、広義のOSではGUIや、オマケのサービスなどもOSに含まれます。
LinuxでもGUIはありますが、それは別で開発されているもので、Linuxカーネルには含まれていません。
対して、WindowsとMacは標準GUIや、ユーティリティなど、様々なソフトが一式入ってきます。<br>この記事では、狭義のOSよりに焦点を絞っていきます。
そもそも、狭義のOSが動かなければ、それより大きい物が動くわけは無いですからね。</p>
<hr>
<h2>どうしてOSを自作するのか ~建前編~</h2><p>C/C++などでプログラムを書くとき、main関数から実行されます。間違って配列の範囲外にアクセスしたりすると、segmentation faultなんてエラーに出くわしたりすると思います。
また、別スレッドを立てて実行なんてのもありがちな話です。
OSについて学ぶことで、どうしてそう決まっているのか、何がsegmentation faultを引き起こすのか、別スレッドってそもそも何なのか、それらが理解できるようになります。<br>そもそも、何気なく様々なソフトウェアが動いていますが、具体的にどうやって実行されるんだろうと思うと気になって仕方がありませんよね？
C言語でprintfって書くと文字列が表示されるのはなぜでしょう？
scanfで入力が取れるのもなぜでしょう？
気になることばかりです。</p>
<p>OSの自作をすることで、これらの疑問全てを解決出来ます。
そして、OSの気持ちが少しばかりわかるようになります。<br>OSを使用せずにプログラムを書くなんてこと、ありえないはずです。
より良い技術者になるために、自分の道具をよく知っておくことは大変大事なことだと思います。<br>「なんかよくわからんけど、動いてる」なんて、自分もよく言ってしまいますが、できることなら、「もちろん大体わかってるよ」なんて言いたいものですよね。</p>
<hr>
<h2>どうしてOSを自作するのか ~本音編~</h2><p>自分で作りたいからです。そして、楽しい。</p>
<hr></div></div></div><footer><div id="footer-content"><span>&copy; 2016 Copyright mopp, All Rights Reserved.</span><span id="powered-by"><br>Powered by<a target="_blank" href="http://harpjs.com/">Harp</a>,<a target="_blank" href="http://purecss.io/">Pure.css</a>,<a target="_blank" href="http://jquery.com/">jQuery</a>,<a target="_blank" href="https://fortawesome.github.io/Font-Awesome/">Font Awesome</a>,<a target="_blank" href="http://devicon.fr/">Devicon</a>.</span></div></footer><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script><script src="/js/lib/ui.js"></script><script src="/js/google_analytics.js"></script></body></html>